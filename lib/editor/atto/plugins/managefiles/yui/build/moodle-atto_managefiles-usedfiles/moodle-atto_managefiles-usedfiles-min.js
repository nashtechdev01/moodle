YUI.add("moodle-atto_managefiles-usedfiles",function(e,t){var n={HASMISSINGFILES:"has-missing-files",HASUNUSEDFILES:"has-unused-files"},r={FILEANCESTOR:".fitem",FORM:"#atto_managefiles_manageform",MISSINGFILES:".missing-files",LOADED:".fm-loaded",DELETEFILESHDR:"#id_deletefileshdr",MISSINGFILESHDR:"#id_missingfileshdr",FILEMANAGER:"#fitem_id_files_filemanager",HASIOS:"body.ios"};M.atto_managefiles=M.atto_managefiles||{},M.atto_managefiles.usedfiles=M.atto_managefiles.usedfiles||{_usercontext:null,_itemid:null,_elementid:null,init:function(t){this._usercontext=t.usercontext,this._itemid=t.itemid,this._elementid=t.elementid;var i=t.files,s=e.one(r.FORM),o,u,a,f,l;if(!s||!window.parent)return;o=this._getUsedFiles(),u=this.findUnusedFiles(i,o),a=this.findMissingFiles(i,o),u.length>0?(s.all('input[type=checkbox][name^="deletefile"]').each(function(t){e.Array.indexOf(u,t.getData("filename"))===-1&&t.ancestor(r.FILEANCESTOR).remove()}),s.addClass(n.HASUNUSEDFILES)):s.removeClass(n.HASUNUSEDFILES);if(a.length>0){f="<ul>";for(l=0;l<a.length;l++)f+="<li>"+e.Escape.html(a[l])+"</li>";f+="</ul>",s.one(r.MISSINGFILES).setHTML("").append(f),s.addClass(n.HASMISSINGFILES)}else s.removeClass(n.HASMISSINGFILES);if(s&&e.one(r.HASIOS))var c=this,h=setInterval(function(){var t=e.all(r.FORM+" "+r.LOADED);if(t){clearInterval(h);var n=c.getElementHeight(r.FILEMANAGER);n+=c.getElementHeight(r.MISSINGFILESHDR),n+=c.getElementHeight(r.DELETEFILESHDR),n+=200,window.parent.postMessage(n,"*")}},1e3);window.parent.addEventListener("message",function(e){var t=window.parent.document.getElementsByTagName("iframe"),n=r.FORM.replace("#",""),i,s,o;for(s=0;s<t.length;s++)i=t[s].innerHTML,i.indexOf(n)&&(o=parseInt(e.data),o>700&&(t[s].style.height=o+"px"))},!1)},_getUsedFiles:function(){var t=e.one(window.parent.document.getElementById(this._elementid+"editable")),n=M.cfg.wwwroot+"/draftfile.php/"+this._usercontext+"/user/draft/"+this._itemid+"/",r=new RegExp(n.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")+"(.+?)[\\?\"']","gm"),i="",s="",o={};while((s=r.exec(t.get("innerHTML")))!==null)i=decodeURI(s[1]),o[i]=!0;return o},getElementHeight:function(t){var n=parseInt(e.one(t).getComputedStyle("height"));return Number.isNaN(n)?0:n},findUnusedFiles:function(e,t){var n,r=[];for(n in e)t[n]||r.push(n);return r},findMissingFiles:function(e,t){var n,r=[];for(n in t)e[n]||r.push(n);return r}}},"@VERSION@",{requires:["node","escape"]});
